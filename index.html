<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ìˆœì°¨ ë™ì˜ìƒ ì¬ìƒê¸°</title>
  <style>
    :root{
      --bg:#0b1220; --card:#0f172a; --muted:#94a3b8; --accent:#38bdf8; --text:#e5e7eb;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,#0b1220,#0a0f1a);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",Apple Color Emoji,Segoe UI Emoji}
    .wrap{max-width:1100px;margin:0 auto;padding:20px;display:flex;flex-direction:column;gap:14px}
    .bar{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .bar h1{font-size:18px;margin:0;color:#fff;opacity:.95}
    button{appearance:none;border:0;background:var(--accent);color:#002033;padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer}
    button.secondary{background:#1f2937;color:var(--text);border:1px solid #334155}
    button.ghost{background:transparent;color:var(--text);border:1px solid #334155}
    button:disabled{opacity:.5;cursor:not-allowed}
    .stage{background:var(--card);border:1px solid #1f2937;border-radius:16px;overflow:hidden;min-height:55vh;display:grid}
    .stage > *{width:100%;height:100%;border:0}
    .meta{display:flex;align-items:center;gap:10px;flex-wrap:wrap;opacity:.9}
    .tag{font-size:12px;padding:4px 8px;border:1px solid #334155;border-radius:999px}
    .list{display:flex;gap:8px;flex-wrap:wrap}
    .chip{padding:6px 10px;border-radius:999px;border:1px solid #334155;background:#0b1220;cursor:pointer}
    .chip.active{background:var(--accent);color:#001724;border-color:transparent}
    .grow{flex:1}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .help{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="bar">
      <h1>ìˆœì°¨ ë™ì˜ìƒ ì¬ìƒê¸°</h1>
      <div class="grow"></div>
      <button id="prevBtn" class="secondary" title="ì´ì „ (â†)">â—€ ì´ì „</button>
      <button id="nextBtn" title="ë‹¤ìŒ (Space / N / â†’)">ë‹¤ìŒ â–¶</button>
      <button id="fsBtn" class="ghost" title="ì „ì²´í™”ë©´ ì „í™˜">â¤¢ ì „ì²´í™”ë©´</button>
    </div>

    <div id="stage" class="stage" tabindex="-1" aria-label="ì¬ìƒ ì˜ì—­">
      <!-- ë™ì ìœ¼ë¡œ video ë˜ëŠ” iframeì„ ë„£ìŒ -->
    </div>

    <div class="meta">
      <span id="idxText" class="tag">1 / 2</span>
      <span id="sourceText" class="help"></span>
      <div class="grow"></div>
      <a id="openNew" class="help" href="#" target="_blank" rel="noopener">ğŸ”— ìƒˆ íƒ­ìœ¼ë¡œ ì—´ê¸°</a>
    </div>

    <div class="row help">
      <div>í‚¤ë³´ë“œ: <b>Space</b> ë˜ëŠ” <b>N</b> ë˜ëŠ” <b>â†’</b> ë‹¤ìŒ / <b>â†</b> ì´ì „</div>
      <div>ì¼ë¶€ ì œê³µì²˜(íŠ¹íˆ OneDrive)ëŠ” ë³´ì•ˆì •ì±…ìœ¼ë¡œ iframe ì°¨ë‹¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê·¸ ê²½ìš° ìœ„ì˜ "ìƒˆ íƒ­ìœ¼ë¡œ ì—´ê¸°"ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.</div>
    </div>

    <details>
      <summary>â• ë§í¬ ì¶”ê°€/ìˆ˜ì • (ê³ ê¸‰)</summary>
      <div class="help" style="margin:8px 0 12px">ê° ì¤„ì— í•˜ë‚˜ì”© ë¶™ì—¬ë„£ìœ¼ë©´ ìë™ìœ¼ë¡œ ìœ í˜•ì„ ê°ì§€í•©ë‹ˆë‹¤. (Google DriveëŠ” ìë™ìœ¼ë¡œ <code>/preview</code> ë³€í™˜)</div>
      <textarea id="bulk" style="width:100%;height:120px;background:#0b1220;color:var(--text);border:1px solid #334155;border-radius:12px;padding:10px"></textarea>
      <div style="margin-top:8px;display:flex;gap:8px">
        <button id="applyBtn" class="secondary">ì ìš©</button>
        <button id="resetBtn" class="ghost">ê¸°ë³¸ ë‘ ë§í¬ë¡œ ë˜ëŒë¦¬ê¸°</button>
      </div>
      <div class="list" id="chips"></div>
    </details>
  </div>

  <script>
    // 1) ì´ˆê¸° ë§í¬ (ì‚¬ìš©ì ì œê³µ)
    const initialUrls = [
      // Google Drive open?id=... ë§í¬
      "https://drive.google.com/open?id=1gWDSK_GmuYOZrsp3wyL0rR1Z0at-ygtP&usp=drive_copy",
      "https://ksldict.korean.go.kr/kslserv/sign/signWord.do?signWordId=3652&from=search",

    ];

    // 2) URLì„ ê³µê¸‰ìë³„ ì¬ìƒ ê°€ëŠ¥í•œ í˜•íƒœë¡œ ë³€í™˜
    function normalizeUrl(u){
      const url = String(u).trim();
      if(!url) return null;

      // Google Drive: ë‹¤ì–‘í•œ í˜•íƒœ ì§€ì› -> /file/d/{id}/preview ë¡œ ë³€í™˜ (iframeìš©)
      if(url.includes("drive.google.com")){
        // open?id=... í˜•íƒœ
        let idMatch = url.match(/[?&]id=([\w-]+)/);
        if(!idMatch){
          // /file/d/{id}/ í˜•íƒœ
          idMatch = url.match(/\/file\/d\/([\w-]+)/);
        }
        if(idMatch){
          const id = idMatch[1];
          return { kind: "iframe", src: `https://drive.google.com/file/d/${id}/preview`, title: `Google Drive (${id})` };
        }
        // ì‹ë³„ ì‹¤íŒ¨ ì‹œ ì›ë³¸ìœ¼ë¡œ iframe ì‹œë„
        return { kind: "iframe", src: url, title: "Google Drive (ì›ë³¸)" };
      }

      // OneDrive / 1drv.ms: ë³´í†µ ìì²´ ë·°ì–´ í˜ì´ì§€ê°€ ìˆì–´ iframeìœ¼ë¡œ ì‹œë„
      if(url.includes("1drv.ms") || url.includes("onedrive.live.com")){
        // ê°€ëŠ¥í•˜ë©´ ê·¸ëŒ€ë¡œ iframeì— ë¡œë“œ (ì¼ë¶€ëŠ” X-Frame-Optionsë¡œ ì°¨ë‹¨ë  ìˆ˜ ìˆìŒ)
        return { kind: "iframe", src: url, title: "OneDrive" };
      }

      // ì¼ë°˜ MP4 ë“± ì§ì ‘ ì¬ìƒ ì‹œë„
      if(/\.(mp4|webm|ogg)(\?|#|$)/i.test(url)){
        return { kind: "video", src: url, title: "ì§ì ‘ ì¬ìƒ" };
      }

      // ì•Œ ìˆ˜ ì—†ëŠ” ê²½ìš° iframeìœ¼ë¡œ ì‹œë„
      return { kind: "iframe", src: url, title: "ë§í¬" };
    }

    // 3) ì¬ìƒ ëª©ë¡ êµ¬ì„±
    let playlist = initialUrls.map(normalizeUrl).filter(Boolean);

    // 4) UI ìš”ì†Œ
    const stage = document.getElementById('stage');
    const idxText = document.getElementById('idxText');
    const sourceText = document.getElementById('sourceText');
    const openNew = document.getElementById('openNew');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const fsBtn = document.getElementById('fsBtn');
    const chips = document.getElementById('chips');
    const bulk = document.getElementById('bulk');

    let current = 0;

    function renderChips(){
      chips.innerHTML = '';
      playlist.forEach((item, i)=>{
        const el = document.createElement('button');
        el.className = 'chip' + (i===current?' active':'');
        el.textContent = `${i+1}. ${item.title || item.src}`;
        el.title = item.src;
        el.onclick = ()=>{ go(i); };
        chips.appendChild(el);
      });
    }

    function setStage(node){
      stage.innerHTML = '';
      stage.appendChild(node);
    }

    function go(i){
      if(i<0 || i>=playlist.length) return;
      current = i;
      const item = playlist[i];

      let node;
      if(item.kind === 'video'){
        node = document.createElement('video');
        node.controls = true;
        node.playsInline = true;
        node.autoplay = true; // ë‹¤ìŒ í´ë¦­ ì‹œ ë°”ë¡œ ì¬ìƒ
        node.src = item.src;
        node.style.background = '#000';
      }else{
        node = document.createElement('iframe');
        node.allow = 'autoplay; encrypted-media; fullscreen; picture-in-picture';
        node.referrerPolicy = 'no-referrer-when-downgrade';
        node.src = item.src;
      }

      setStage(node);
      idxText.textContent = `${i+1} / ${playlist.length}`;
      sourceText.textContent = item.src;
      openNew.href = item.src;
      renderChips();
      // ì ‘ê·¼ì„± í¬ì»¤ìŠ¤ ì´ë™
      stage.focus({preventScroll:true});
    }

    function next(){
      const n = current + 1;
      if(n < playlist.length) go(n);
    }
    function prev(){
      const p = current - 1;
      if(p >= 0) go(p);
    }

    // ì „ì²´í™”ë©´ í† ê¸€
    fsBtn.addEventListener('click', ()=>{
      const el = stage;
      if(!document.fullscreenElement){
        el.requestFullscreen?.();
      }else{
        document.exitFullscreen?.();
      }
    });

    // ë²„íŠ¼ ë°”ì¸ë”©
    nextBtn.onclick = next;
    prevBtn.onclick = prev;

    // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
    window.addEventListener('keydown', (e)=>{
      if(e.target.tagName === 'TEXTAREA') return; // ì…ë ¥ ì¤‘ ì˜ˆì™¸
      if(e.code === 'Space' || e.key.toLowerCase() === 'n' || e.key === 'ArrowRight'){
        e.preventDefault(); next();
      }else if(e.key === 'ArrowLeft'){
        e.preventDefault(); prev();
      }
    });

    // ëŒ€ëŸ‰ ì…ë ¥ ì ìš©/ì´ˆê¸°í™”
    document.getElementById('applyBtn').onclick = ()=>{
      const lines = bulk.value.split(/\n+/).map(s=>s.trim()).filter(Boolean);
      if(lines.length){
        playlist = lines.map(normalizeUrl).filter(Boolean);
        current = 0; go(0);
      }
    };
    document.getElementById('resetBtn').onclick = ()=>{
      playlist = initialUrls.map(normalizeUrl).filter(Boolean);
      bulk.value = initialUrls.join('\n');
      current = 0; go(0);
    };

    // ì´ˆê¸° ìƒíƒœ
    bulk.value = initialUrls.join('\n');
    go(0);
  </script>
</body>
</html>
